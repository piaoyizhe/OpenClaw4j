# 记忆整理工作流

## Description
本工作流用于整理IDENTITY、MEMORY和USER相关文档，检测冲突、优化格式并提供备份机制。

## Tools
可用工具：
- read_file: 读取文件内容
- write_file: 写入文件内容
- list_files: 列出目录文件
- create_directory: 创建目录

## 涉及的文件
- ./memory/IDENTITY.md - 数字员工身份文档
- ./memory/MEMORY.md - 记忆存储文档
- ./memory/USER.md - 用户记忆文档
- ./memory/backups/ - 备份文件夹

## 工作流程

### 步骤1：创建备份
在执行整理操作前，先将原始文件备份到./memory/backups/目录：
- 备份文件名格式：{原文件名}_{yyyy-MM-dd_HH:mm:ss}.md
- 例如：IDENTITY_2024-12-25_14:30:00.md

### 步骤2：读取文档内容
读取以下文档内容：
- ./memory/IDENTITY.md
- ./memory/MEMORY.md
- ./memory/USER.md  

### 步骤3：冲突检测
调用大模型分析文档内容，检测：
1. 两个文档之间是否存在信息冲突
2. 是否有重复或冗余的内容
3. 提出需要用户决策的问题

### 步骤4：重复内容处理
识别并处理重复内容：
- 保留最新或最完整的版本
- 标记需要用户确认的内容

### 步骤5：格式优化
优化文档格式，确保：
1. 标题层级清晰（一级标题、二级标题等）
2. 列表格式统一
3. 段落间距合理
4. 保持所有原始内容不变

### 步骤6：保存优化后的文档
将优化后的文档保存回原位置。

### 步骤7：生成对比报告
生成整理前后的对比报告，包括：
- 原始文档长度 vs 优化后文档长度
- 内容变化统计
- 发现的问题列表

## 质量保证
1. 备份机制：每次整理前自动备份原始文件
2. 信息完整性：确保整理过程中信息不丢失
3. 唯一性维护：避免重复信息
4. 可恢复性：备份文件可随时恢复

## 交互设计
1. 手动触发：用户输入触发词（如"整理文档"）启动工作流
2. 冲突确认：对于检测到的冲突，提示用户确认处理方式
3. 结果报告：提供详细的整理报告和对比信息

## 注意事项
1. 备份文件存放在./memory/backups/目录
2. 每次整理都会创建新的备份文件
3. 原始文件备份后可随时恢复
4. 格式优化只调整格式，不改变内容
5. 如整理失败，可从备份恢复
