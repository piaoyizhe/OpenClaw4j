# OpenClaw 数字员工

## 简介

OpenClaw 是一个基于 Java 开发的 AI 智能助手应用程序，集成大语言模型（LLM）和多种工具能力，支持记忆系统、工作流管理、远程服务器操作等功能。它可以帮助用户完成各种任务，如文件管理，网络操作、系统管理、邮件发送、日志记录等。

## 系统要求

- Java Runtime Environment (JRE) 1.8 或更高版本
- Windows、Linux 或 macOS 操作系统
- 网络连接（用于调用大模型 API）

## 功能特性

### 🤖 AI 能力
- 基于大语言模型的智能对话
- 意图识别和工作流自动匹配
- 记忆系统：长期记忆和短期记忆
- 上下文理解和连续对话

### 📁 文件操作
- 多功能文件读取（pdf、docx、txt等）
- 图片识别（使用GLM-4.6V视觉模型）
- 文件压缩/解压（zip/unzip）
- 标准化文件夹结构管理

### 🌐 网络操作
- HTTP 请求发送（GET/POST/PUT/DELETE）
- 网络连接测试
- 获取网络接口信息

### 💻 Shell 命令
- 本地 Shell 命令执行
- **SSH 远程连接**（支持有状态的远程操作）
- 远程服务器命令执行

### 📧 邮件系统
- 邮件发送（支持自定义发件人姓名）
- SMTP SSL 支持

### 📝 日志管理
- 自动生成日报
- 自动生成周报
- 自动生成月报
- 定时任务执行

### 🔍 智能搜索
- 记忆内容搜索
- 向量搜索支持
- 相关性排序

### 📚 工作流
- 多种预定义工作流
- 自动化任务处理
- 技能匹配

## 工具列表

### 📁 文件操作类
| 工具名称 | 功能描述 |
|---------|---------|
| create_file | 创建新文件并写入内容 |
| read_file | 读取指定文件的内容 |
| update_file | 更新指定文件的内容 |
| delete_file | 删除指定文件 |
| get_file_info | 获取指定文件的信息 |
| list_files | 列出指定目录下的文件和子目录 |
| create_directory | 创建指定的目录 |

### 📤 邮件与报告类
| 工具名称 | 功能描述 |
|---------|---------|
| send_email | 发送邮件到指定邮箱 |
| write_daily_report | 写日报 |
| read_daily_report | 读日报 |
| list_daily_reports | 列出所有日报 |
| write_weekly_report | 写周报 |
| read_weekly_report | 读周报 |
| list_weekly_reports | 列出所有周报 |

### 🌐 网络与HTTP类
| 工具名称 | 功能描述 |
|---------|---------|
| send_http_request | 发送HTTP请求（GET/POST/PUT/DELETE等） |
| test_network_connection | 测试网络连接 |
| get_network_interfaces | 获取网络接口信息 |
| get_local_ip | 获取本地网络信息（主机名和IP地址） |

### 🔧 系统与命令类
| 工具名称 | 功能描述 |
|---------|---------|
| execute_shell | 执行Shell命令 |
| get_system_info | 获取系统信息（操作系统、Java版本等） |
| get_tools_list | 获取可用的工具列表 |

### 🖥️ SSH远程连接类
| 工具名称 | 功能描述 |
|---------|---------|
| ssh_connect | 连接到远程服务器 |
| ssh_disconnect | 断开SSH连接 |
| ssh_execute | 在远程服务器上执行命令 |
| ssh_list | 列出所有活动的SSH连接 |

### 🧠 记忆管理类
| 工具名称 | 功能描述 |
|---------|---------|
| write_memory | 写入内容到指定记忆文件 |
| read_memory | 读取指定记忆文件的内容 |
| search_memory | 查询记忆系统中的信息 |

### 🌤️ 其他工具
| 工具名称 | 功能描述 |
|---------|---------|
| get_weather | 获取指定城市的天气信息 |

## 安装和运行

### 方式一：使用启动脚本

1. 解压发布包到任意目录
2. 根据操作系统选择启动方式：
   - **Windows**：双击 `start.bat`
   - **Linux/macOS**：终端运行 `chmod +x start.sh && ./start.sh`

### 方式二：手动运行

```bash
java -jar openclaw4j-1.0-SNAPSHOT-jar-with-dependencies.jar
```

## 首次运行配置

首次运行时，系统会引导您配置以下信息：

1. **数字员工基本信息**
   - 姓名、工号、功能简介

2. **大模型配置**
   - API 密钥
   - API 地址
   - 模型名称
   - 视觉模型（用于图片识别）

3. **邮箱配置**（可选）
   - SMTP 服务器
   - 端口
   - 用户名
   - 密码/授权码
   - 发件人姓名

## 配置说明

配置文件位于 `resources/application.yml`：

```yaml
openclaw:
  # 大模型配置
  llm:
    provider: glm
    model: glm-4.7
    vision_model: glm-4.6v  # 视觉模型配置
    api_key: your_api_key
    api_url: https://open.bigmodel.cn/api/paas/v4/chat/completions
    timeout: 30000

  # 邮件配置
  mail:
    enabled: true
    host: smtp.qq.com
    port: 465
    username: your_email@qq.com
    password: your授权码
    ssl: true
    timeout: 30000

  # 记忆配置
  memory:
    enabled: true
    storage:
      directory: ./memory
```

## 文件系统架构

项目使用标准化的文件夹结构：

```
file/
├── desktop/      # 临时文件目录（支持自动清理）
├── learning/    # 待学习资料目录
├── document/    # 已处理资料归档目录（按类别分类）
│   ├── 招标文件/
│   ├── 技术文档/
│   ├── 会议纪要/
│   └── ...
└── recycle/     # 回收站目录

memory/
├── backups/     # 记忆备份目录
├── IDENTITY.md  # 数字员工身份文档
├── SOUL.md      # 系统核心特质文档
├── MEMORY.md    # 知识记忆文档
└── daily_logs/ # 日报目录
```

## 工作流手册

项目包含多个工作流手册，位于 `resources/workflows/` 目录：

- `file_management_manual.md` - 文件管理工作流
- `school_bidding_manual.md` - 学校招标信息工作流
- `school_timetable_manual.md` - 学校排课工作流
- `learning_material_workflow.md` - 学习资料处理工作流
- `document_organization_workflow.md` - 文档整理工作流
- `daily_report_workflow.md` - 日报发送工作流

### 学习资料处理工作流

当用户将文件放入 `./file/learning` 目录后，可以触发此工作流：

1. 扫描learning目录中的所有文件
2. 读取文件内容（支持pdf、docx、txt、图片等）
3. 使用大模型提取知识摘要
4. 智能分类（招标文件、技术文档等）
5. 移动到 `./file/document` 对应分类目录
6. 记录到MEMORY.md

### 文档整理工作流

定期整理记忆文档：

1. 备份原始文档到 `./memory/backups`
2. 检测IDENTITY.md和MEMORY.md之间的冲突
3. 识别重复内容
4. 优化文档格式
5. 生成对比报告

## 使用示例

### 基本对话
```
OpenClaw> 你好，你能做什么？
```

### 发送邮件
```
OpenClaw> 给我发一封测试邮件到 591543227@qq.com
```

### SSH 远程操作
```
# 先连接远程服务器
OpenClaw> 连接到 192.168.3.109，用户名 admin，密码 123456

# 执行命令
OpenClaw> 在 192.168.3.109 上执行命令：cd ~/DataCenter/ && jps
```

### 文件操作
```
OpenClaw> 读取 /home/user/test.txt 文件内容
OpenClaw> 列出当前目录下的所有文件
```

### 搜索记忆
```
OpenClaw> 搜索关于 Java 编程的记忆
```

### 处理学习资料
```
OpenClaw> 处理学习资料
（系统会自动扫描 ./file/learning 目录并进行知识提取）
```

## 目录结构

```
openclaw/
├── openclaw4j-1.0-SNAPSHOT-jar-with-dependencies.jar  # 主程序
├── start.bat                      # Windows 启动脚本
├── start.sh                       # Linux/macOS 启动脚本
├── file/                          # 文件目录
│   ├── desktop/                   # 临时文件
│   ├── learning/                  # 待学习资料
│   ├── document/                  # 已处理文档
│   └── recycle/                   # 回收站
├── resources/                     # 资源文件夹
│   ├── application.yml            # 配置文件
│   └── workflows/                # 工作流手册
└── memory/                       # 记忆数据文件夹
    └── backups/                   # 备份目录
```

## 技术栈

- **语言**：Java 8
- **大模型**：智谱 GLM
- **数据库**：SQLite
- **HTTP 客户端**：OkHttp3
- **JSON 处理**：FastJSON
- **邮件**：JavaMail
- **SSH**：JSch
- **PDF处理**：PDFBox
- **Office文档处理**：Apache POI

## 故障排除

- **无法连接大模型**：检查 API 密钥和网络连接
- **邮件发送失败**：检查 SMTP 配置和授权码
- **SSH 连接失败**：检查服务器地址、用户名和密码
- **记忆搜索无结果**：确保记忆文件已正确创建
- **文件读取失败**：检查文件格式是否支持（pdf、docx、txt等）

## 构建项目

```bash
# 编译
mvn clean compile

# 打包
mvn package

# 运行
mvn exec:java -Dexec.mainClass="com.openclaw.Main"
```

## 许可证

MIT License

---

## 设计思路

### 架构设计理念

OpenClaw 采用**大脑模拟架构**，借鉴人脑的结构和功能，将不同模块类比为大脑的不同区域：

```
┌─────────────────────────────────────────────────────────┐
│                     用户交互层                           │
│                    ConsoleInterface                      │
└────────────────────────┬────────────────────────────────┘
                         │
┌────────────────────────▼────────────────────────────────┐
│                    前额叶皮层 (Prefrontal)               │
│              任务规划、决策、意图识别                     │
│              • 接收用户输入                             │
│              • 判断操作类型                             │
│              • 协调各模块工作                           │
└────────────────────────┬────────────────────────────────┘
                         │
         ┌──────────────┼──────────────┐
         │              │              │
         ▼              ▼              ▼
┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│   海马体    │ │  工作流管理器 │ │  任务执行器  │
│ (Hippocampus)│ │(WorkflowMgr) │ │(TaskExecutor)│
│  记忆分析   │ │  工作流程    │ │   工具调用  │
└─────────────┘ └─────────────┘ └─────────────┘
         │              │              │
         └──────────────┼──────────────┘
                        │
┌───────────────────────▼──────────────────────────────┐
│                     工具层 (Tools)                       │
│  FileTool  HttpTool  ShellTool  EmailTool  ...       │
└───────────────────────┬─────────────────────────────────┘
                        │
┌───────────────────────▼──────────────────────────────┐
│                   记忆系统 (Memory)                     │
│  MemoryManager  SQLite  LongTermMemory  Search         │
└────────────────────────────────────────────────────────┘
```

### 核心模块说明

| 模块 | 类比 | 功能描述 |
|-----|------|---------|
| **Prefrontal** | 前额叶皮层 | 任务规划、决策、意图识别，协调各模块工作 |
| **Hippocampus** | 海马体 | 记忆分析、内容提炼、记忆目标判断 |
| **WorkflowManager** | - | 工作流管理、意图识别，手册加载执行 |
| **TaskExecutor** | - | 任务执行、工具调用、结果处理 |
| **MemoryManager** | 大脑皮层 | 记忆存储、对话管理、日志生成 |
| **ToolManagerRegistry** | - | 工具注册、动态路由、缓存管理 |

### 设计原则

1. **模块化设计**：各模块职责清晰，通过接口通信
2. **单例模式**：核心管理器使用单例，保证全局唯一
3. **延迟加载**：非核心组件采用延迟加载，提高启动速度
4. **缓存机制**：工具信息采用缓存，避免重复计算
5. **可扩展性**：通过工具注册机制，支持动态扩展

---

## 系统运行逻辑

### 整体流程

```
用户输入 → Prefrontal.processQuery()
                │
                ▼
        ┌───────────────────┐
        │  1. 意图识别       │
        │  识别用户意图类型   │
        └────────┬──────────┘
                 │
        ┌────────▼──────────┐
        │  2. 工作流匹配     │
        │  加载相关工作手册   │
        └────────┬──────────┘
                 │
        ┌────────▼──────────┐
        │  3. 记忆检索       │
        │  搜索相关内容      │
        └────────┬──────────┘
                 │
        ┌────────▼──────────┐
        │  4. LLM处理       │
        │  构建提示词       │
        │  调用大模型       │
        └────────┬──────────┘
                 │
        ┌────────▼──────────┐
        │  5. 工具执行      │
        │  如需要则调用工具   │
        └────────┬──────────┘
                 │
        ┌────────▼──────────┐
        │  6. 记忆更新      │
        │  分析并更新记忆   │
        └────────┬──────────┘
                 │
                 ▼
             返回结果
```

### 意图识别流程

```
用户输入
    │
    ▼
┌──────────────────────┐
│  Prefrontal 接收请求  │
└──────────┬───────────┘
           │
           ▼
┌──────────────────────┐
│  WorkflowManager    │
│  进行意图识别        │
└──────────┬───────────┘
           │
    ┌──────┴──────┐
    │             │
    ▼             ▼
┌────────┐   ┌────────┐
│ 需要工作流│   │普通对话 │
└────┬───┘   └───┬────┘
     │            │
     ▼            ▼
加载工作手册   直接调用LLM
     │            │
     └─────┬──────┘
           │
           ▼
      返回结果
```

---

## 运行机制

### 1. 工具注册机制

OpenClaw 采用**工具注册机制**，支持动态扩展：

```
┌─────────────────────────────────────┐
│     ToolManagerRegistry (单例)        │
│  • 注册工具管理器                     │
│  • 维护工具映射                       │
│  • 提供工具查询                       │
└────────────────┬────────────────────┘
                 │
    ┌────────────┼────────────┐
    ▼            ▼            ▼
┌────────┐  ┌────────┐  ┌────────┐
│ System │  │ Memory │  │ Shell  │
│ ToolMgr│  │ ToolMgr│  │ ToolMgr│
└────────┘  └────────┘  └────────┘
    │            │            │
    ▼            ▼            ▼
┌────────┐  ┌────────┐  ┌────────┐
│ 工具1  │  │ 工具1  │  │ 工具1  │
│ 工具2  │  │ 工具2  │  │ 工具2  │
│ ...    │  │ ...    │  │ ...    │
└────────┘  └────────┘  └────────┘
```

**工具注册示例**：
```java
registerTool("send_email", "发送邮件", params, (parameters) -> {
    // 工具执行逻辑
    return result;
});
```

### 2. 记忆系统机制

记忆系统分为**短期记忆**和**长期记忆**：

```
┌────────────────────────────────────────────┐
│              记忆系统架构                   │
├────────────────────────────────────────────┤
│  短期记忆 (Session Memory)                  │
│  • 对话历史记录                             │
│  • 当前会话上下文                           │
│  • SQLite 数据库存储                       │
└────────────────────┬───────────────────────┘
                     │
                     ▼
┌────────────────────────────────────────────┐
│           海马体 (Hippocampus)              │
│  • 分析用户输入                             │
│  • 提炼关键信息                             │
│  • 判断记忆目标                             │
│  • 冲突检测与解决                          │
└────────────────────┬───────────────────────┘
                     │
                     ▼
┌────────────────────────────────────────────┐
│  长期记忆 (Long-term Memory)                │
│  • USER.md - 用户身份信息                   │
│  • SOUL.md - 系统核心特质                   │
│  • MEMORY.md - 知识记忆                    │
│  • 对话归档文件                             │
└────────────────────────────────────────────┘
```

### 3. 工作流机制

工作流系统支持自动化任务处理：

```
工作流执行流程：

用户请求
    │
    ▼
┌──────────────────┐
│  意图识别         │
│  (LLM分析)       │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  匹配工作手册     │
│  (Skills格式)     │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  加载工具列表     │
│  (过滤相关工具)   │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  构建提示词       │
│  (含工作流内容)   │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  LLM + Tools     │
│  执行任务         │
└──────────────────┘
```

### 4. 文件处理机制

文件处理工作流遵循以下流程：

```
用户触发文件处理
    │
    ▼
┌──────────────────┐
│  扫描源目录      │
│  (learning/等)   │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  读取文件内容    │
│  (PDF/DOCX/TXT) │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  图片识别        │
│  (GLM-4.6V)     │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  知识提取        │
│  (LLM摘要)      │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  智能分类        │
│  (LLM判断)      │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  归档存储        │
│  (移动到分类目录) │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  记忆更新        │
│  (写入MEMORY)   │
└──────────────────┘
```

### 5. 日志生成机制

系统自动定时生成工作报告：

```
定时任务 (Cron Expression)
    │
    ├── 每日 22:00 → 生成日报
    ├── 每周六 22:00 → 生成周报
    └── 每月1日 22:00 → 生成月报

生成流程：
1. 收集对话记录
2. 使用 LLM 提炼内容
3. 生成报告文件
4. 保存到 memory 目录
```

### 6. SSH 连接机制

SSH 工具支持有状态的远程操作：

```
连接状态管理：

SSHUtils (单例)
    │
    ├── Map<String, Session> sessions
    │   └── 存储活动的 SSH 连接
    │
    └── 方法：
        ├── connect()   → 建立连接
        ├── execute()   → 执行命令
        └── disconnect() → 断开连接

使用流程：
1. ssh_connect() → 建立连接（会话保持）
2. ssh_execute() → 多次执行命令
3. ssh_disconnect() → 断开连接
```

---

## 核心类说明

| 类名 | 职责 |
|-----|------|
| `Main` | 程序入口 |
| `ConsoleInterface` | 控制台交互界面 |
| `Prefrontal` | 任务规划和决策中心 |
| `Hippocampus` | 记忆分析和提炼 |
| `WorkflowManager` | 工作流和意图识别 |
| `TaskExecutor` | 任务执行器 |
| `MemoryManager` | 记忆总管理器 |
| `LongTermMemoryManager` | 长期记忆管理 |
| `ToolManagerRegistry` | 工具注册表 |
| `ConfigManager` | 配置管理器 |
| `LLMClient` | 大模型客户端 |
| `FileReaderUtils` | 多功能文件读取工具 |
| `CompressionUtils` | 压缩/解压工具 |
